{% extends "base.html.jinja2" %}
{% block heading %}
    <h1 class="display-2">מבחן איכות שמע</h1>
    <p class="lead">האוניברסיטה העברית</p>

    <h2 class="display-4">הוראות</h2>
    <hr class="my-4">

    <p>
        בשאלון הקרוב תתבקשו לדרג את איכות וטבעיות השמע בקטעי דיבור קצרים שיוצרו באופן מלאכותי. עבור כל הקלטה תענו על 2
        שאלות:
    </p>
    <p>
        בשאלה הראושנה תדרגו עד כמה הדיבור טבעי. התייחסו לגוון קול, אינטנאציה ושטף דיבור.
    </p>
    ציון טבעיות השמע יהיה בין
    1 (גרוע) ל-5
    (מצויין), כאשר:
    <ul>
        <li>ציון 1 - גרוע - רובוטי</li>
        <li>ציון 2 - רע</li>
        <li>ציון 3 - בינוני</li>
        <li>ציון 4 - טוב</li>
        <li>ציון 5 - מצויין - טבעי</li>
    </ul>
    </p>

    <p>
        בשאלה השניה תדרגו את תוכן הדיבור. התייחסו להתאמה של הדיבור לטקסט והגייה נכונה של המילים בעברית.
    </p>
    ציון תוכן השמע יהיה בין
    1 (גרוע) ל-5
    (מצויין), כאשר:
    <ul>
        <li>ציון 1 - גרוע - המילים לא תואמות את הטקסט</li>
        <li>ציון 2 - רע</li>
        <li>ציון 3 - בינוני</li>
        <li>ציון 4 - טוב</li>
        <li>ציון 5 - מצויין - הגייה מדויקת</li>
    </ul>
    </p>


    <p>
        מומלץ להקשיב לכמה הקלטות לפני שמתחילים לדרג כדי לקבל הערכה על ההבדלים בין ההקלטות.
    </p>
    <p>בטעינת המבחן הקטעים נדגמו מאוסף קטעים גדול וסודרו באופן רנדומלי.</p>
    <p>נבקש לעשות את המבחן בחדר שקט ועם אוזניות.</p>
    <p>
        המבחן לא תומך בדפדפן פיירפוקס.

    </p>
    <p>
        אין קטעים שקטים במבחן, אם לא שומעים דגימה זה כי היא עדיין בטעינה.

    </p>
    <p>
        תודה רבה על ההשתתפות! עמית.
    </p>


{% endblock %}
{% block form_questions %}
    {% for question in questions %}
        <div class="card form-group {{ question.dir }}">
            <div class="card-header">זיהוי (ירד בגרסה האמיתי): {{ question.title }}</div>
            <div class="card-header">טקסט: {{ question.prompt }}</div>
            <div class="card-header">
                <audio controls src="{{ question.audio_path | urlencode }}">
                    Your browser does not support the audio element.
                </audio>
            </div>

            <div class="card-body">
                <p>
                    עד כמה הדיבור נשמע טבעי?
                </p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_n"
                           id="{{ question.name }}_n_1"
                           value="5" required>
                    <label class="form-check-label" for="{{ question.name }}_n_1">5 (מצויין, טבעי)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_n"
                           id="{{ question.name }}_n_2"
                           value="4" required>
                    <label class="form-check-label" for="{{ question.name }}_n_2">4 (טוב)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_n"
                           id="{{ question.name }}_n_3"
                           value="3" required>
                    <label class="form-check-label" for="{{ question.name }}_n_3">3 (בינוני)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_n"
                           id="{{ question.name }}_n_4"
                           value="2" required>
                    <label class="form-check-label" for="{{ question.name }}_n_4">2 (רע)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_n"
                           id="{{ question.name }}_n_5"
                           value="1" required>
                    <label class="form-check-label" for="{{ question.name }}_n_5">1 (גרוע, רובוטי)</label>
                </div>
            </div>

            <div class="card-body">
                <p>
                    עד כמה תוכן הדיבור מדויק?
                </p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_c"
                           id="{{ question.name }}_c_1"
                           value="5" required>
                    <label class="form-check-label" for="{{ question.name }}_c_1">5 (מצויין, הגייה מדוייקת)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_c"
                           id="{{ question.name }}_c_2"
                           value="4" required>
                    <label class="form-check-label" for="{{ question.name }}_c_2">4 (טוב)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_c"
                           id="{{ question.name }}_c_3"
                           value="3" required>
                    <label class="form-check-label" for="{{ question.name }}_c_3">3 (בינוני)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_c"
                           id="{{ question.name }}_c_4"
                           value="2" required>
                    <label class="form-check-label" for="{{ question.name }}_c_4">2 (רע)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ question.name }}_c"
                           id="{{ question.name }}_c_5"
                           value="1" required>
                    <label class="form-check-label" for="{{ question.name }}_c_5">1 (גרוע, אין קשר בין הדיבור
                        לטקסט)</label>
                </div>
            </div>
        </div>
    {% endfor %}

    <script type="text/javascript">
        function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        function shuffleForm() {
            let gt = document.getElementsByClassName("gt")
            let mms = document.getElementsByClassName("mms")
            let roboshaul = document.getElementsByClassName("roboshaul")
            let word_osim = document.getElementsByClassName("word_osim")
            let word_shaul = document.getElementsByClassName("word_shaul")
            let additional = document.getElementsByClassName("additional")

            gt_array = Array.from(gt)
            mms_array = Array.from(mms)
            roboshaul_array = Array.from(roboshaul)
            word_osim_array = Array.from(word_osim)
            word_shaul_array = Array.from(word_shaul)
            additional_array = Array.from(additional)

            gt_array.forEach((e) => e.remove());
            mms_array.forEach((e) => e.remove());
            roboshaul_array.forEach((e) => e.remove());
            word_osim_array.forEach((e) => e.remove());
            word_shaul_array.forEach((e) => e.remove());
            additional_array.forEach((e) => e.remove());

            function getRandomNumber(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            // Generate 10 unique random numbers between 1 and 20
            const randomNumbers = [];
            while (randomNumbers.length < 10) {
                const randomNumber = getRandomNumber(0, 20);
                if (!randomNumbers.includes(randomNumber)) {
                    randomNumbers.push(randomNumber);
                }
            }

            formArray = [
                gt_array[randomNumbers[0]],
                gt_array[randomNumbers[1]],
                mms_array[randomNumbers[2]],
                mms_array[randomNumbers[3]],
                roboshaul_array[randomNumbers[4]],
                roboshaul_array[randomNumbers[5]],
                word_osim_array[randomNumbers[6]],
                word_osim_array[randomNumbers[7]],
                word_shaul_array[randomNumbers[8]],
                word_shaul_array[randomNumbers[9]],
                additional_array[getRandomNumber(0,4)]
            ]

            console.log(randomNumbers)


            shuffle(formArray);
            let questions = document.getElementById("questions");
            formArray.forEach((e) => questions.appendChild(e));
        }

        window.addEventListener('DOMContentLoaded', (e) => shuffleForm());
    </script>
{% endblock %}